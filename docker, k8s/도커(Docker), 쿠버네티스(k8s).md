# 1. 도커 (Docker)

## 1.1 도커란?
도커는 2013년에 등장한 컨테이너 기반 가상화 도구입니다.

> 가상화 : 하나의 물리 서버에 여러 리소스를 생성할 수 있는 기술

## 1.2 장점

도커를 사용하게 되면 이미지를 기반으로 컨테이너를 실행할 수 있고, 특정 컨테이너의 상태를 이미지로도 만들 수 있습니다.

이 이미지는 파일로 보관하거나 원격 저장소(Docker hub)를 통해 쉽게 공유할 수 있으며, 도커만 설치되어 있다면 어디서나 컨테이너로 실행할 수 있습니다.

도커 이미지를 통해 서버를 구성하게 되면 이미지를 만든 시점으로 동일한 환경 구성의 서버들을 배포할 수 있습니다.

또한 컨테이너를 가상화하여 배포하게 되면 프로세스를 격리해서 실행하고 관리할 수 있기 때문에 리소스를 효율적으로 사용할 수 있습니다.


## 1.2 정리

도커 이미지를 통해 컨테이너를 가상화하여 배포하면 동일한 환경 구성으로 서버들을 배포할 수 있고,

각 서버들은 격리되어 리소스 한계를 명시함으로써 효율적으로 리소스를 활용할 수 있습니다.

# 2. 쿠버네티스 (kubernetes, k8s)

## 2.1 쿠버네티스란?

쿠버네티스는 컨테이너 작업을 자동화하는 오픈소스 플램폿, 컨테이너 오케스트레이션 도구입니다.

적은 수의 컨테이너라면 수동으로 직접 배포해도 되지만, 컨테이너의 수가 많아지게 되면 컨테이너 관리에 어려움이 발생합니다.

쿠버네티스를 사용하게 되면 컨테이너가 정상적으로 작동하고 있는지 모니터링, 재기동, 삭제 등 컨테이너에 대한 종합적인 관리를 해줍니다.

## 2.2 쿠버네티스 용어

### 2.2.1 오브젝트 스펙 (Object Spec)
오브젝트는 오브젝트의 설정 정보를 기술한 오브젝트 스펙으로 정의가 되고,

이는 yaml이나 json파일, 오브젝트 생성 시 인자로 전달하여 정의할 수 있습니다.

### 2.2.2 기본 오브젝트 (Basic Object)
쿠버네티스에 의해서 배포 및 관리되는 가장 기본적인 오브젝트로 Pod, Service, Volume, Namespace가 있습니다.

Pod는 컨테이너화된 애플리케이션, Service는 로드밸런서, Volume은 디스크, Namespace는 패키지명 정도로 생각하면 됩니다.

### 2.2.3 파드 (Pod)
파드는 쿠버네티스에서 가장 기본적인 배포 단위로, 컨테이너를 포함하는 단위입니다.

컨테이너를 포함하는 단위라는 건 하나 이상의 컨테이너가 파드에 배포될 수 있다라는 겁니다.

하나의 파드에 여러 컨테이너를 묶어서 배포함으로써 파드 내의 컨테이너들은 IP와 Port를 공유하게 됩니다.

또한 디스크 볼륨을 공유할 수 있어 다른 컨테이너의 파일을 읽어올 수 있습니다.

### 2.2.4 서비스 (Service)

일반적으로 분산환경에서 하나의 파드로만 서비스를 제공하는 경우는 드물고,

여러 개의 파드를 생성하여 이를 로드밸런서를 통해 하나의 IP와 Port로 묶어서 제공해야합니다.

파드는 동적으로 생성되고 삭제되면서 노드를 옮겨 다니기도 하기 때문에 발급받은 IP가 변경될 수 있습니다.

이러한 파드에 고정된 주소로 접근하기 위해 사용하는 것이 바로 서비스입니다.

서비스는 여러 개의 파드에 접근할 수 있는 하나의 IP를 제공하고 주로 로드밸런서의 역할을 합니다.

파드의 라벨과 서비스의 라벨 셀렉터를 통해 서비스로 묶을 파드를 정할 수 있습니다.

서비스의 타입으로는 ClusterIP, NodePort, LoadBalancer 등이 있습니다.

- `ClusterIP` : 클러스터 내부에서만 접근 가능한 IP를 제공합니다.
- `NodePort` : 외부에서 접근 가능한 Port를 제공합니다. (ClusterIP의 기능은 기본적으로 포함)
- `LoadBalancer` : 외부의 로드밸런서를 파드에 연결합니다. 접근 가능한 외부 IP를 부여하기 때문에, 외부에서 파드에 접근할 수 있습니다.

### 2.2.5 볼륨 (Volume)

컨테이너마다 기본적으로 로컬 디스크를 생성하면서 파드가 실행되지만

파드가 동적인 이유와 마찬가지로 컨테이너의 로컬 디스크도 영구적이지 않습니다.

그래서 영구적으로 파일을 저장하기 위해서 볼륨이 필요합니다.

즉, 볼륨은 컨테이너의 외장디스크로 생각하면 됩니다.

파드 내의 컨테이너들은 공유되기 때문에 여러 컨테이너들이 이 볼륨을 공유하여 사용할 수 있습니다.

### 2.2.6 컨트롤러 (Controller)

컨트롤러는 파드를 생성하고 관리하는 역할을 합니다.

컨트롤러의 종류에는 레플리카세트, 레플리케이션 컨트롤러, 디플로이먼트, 스테이트풀세트, 잡, 크론잡 등이 있습니다.

- `레플리카세트(ReplicaSet)` : 레플리카에 선언된 갯수만큼 파드가 항상 클러스터 내에서 실행되도록 합니다.

- `레플리케이션 컨트롤러(Replication Controller)` : 레플리카세트와 같은 기능인데 옛 버전이라고 생각하면 됩니다.

- `디플로이먼트(Deployment)` : 레플리카세트, 레플리케이션 컨트롤러보다 상위 개념입니다. 디플로이먼트가 내부적으로 레플리카세트를 생성하고 이를 이용해 파드를 관리합니다. Stateless 애플리케이션을 배포할 때는 주로 이 디플로이먼트를 사용합니다.

- `스테이트풀세트(StatefulSet)` : 상태가 있는 파드를 관리하는 컨트롤러입니다. 여러 개의 파드 간에 순서를 지정해서 실행시켜야 하거나, 특정 파드를 재시작할 때 데이터를 유지해야 하는 경우 등에 사용할 수 있습니다.

- `잡(Job)` : 한번 실행하고 종료하는 형태의 작업을 실행할 때 사용합니다.

- `크론잡(CronJob)` : 크론잡은 지정된 시간에 주기적으로 실행해야 하는 작업에 사용합니다.

### 2.2.7 인그레스 (Ingress)

인그레스는 외부에서 클러스터 내부로 접근하는 요청을 어떻게 처리할지를 정의할 수 있습니다.

이 정의해놓은 리소스를 실제로 동작시키는 것은 인그레스 컨트롤러입니다.

위에서 설명한 서비스의 NodePort를 사용해도 외부에서 접근하게 할 수 있지만,

URL을 사용할 수 없기 때문에 인그레스를 사용합니다.
